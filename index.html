<!DOCTYPE html>
<html>
<head>

    <title>Live Taxi Map</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css"/>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>

            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_845a0ec8331ce3e14fbac42f2fe52798 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>
</head>
<body>
 
<div id="timestamp" style="position: fixed; bottom: 10px; left: 10px; z-index:9999; background-color: white; padding: 5px; font-size: 12px; display: none;
            border: 1px solid #ccc;">
    Last updated: 2025-08-22 12:49:15
</div>

<div id="taxi-count" style="position: fixed; top: 10px; right: 10px; left: auto; z-index:9999; background-color: white; padding: 5px; font-size: 12px; display: none;
            border: 1px solid #ccc;">
    Total taxis: 0
</div>

<div class="folium-map" id="map_845a0ec8331ce3e14fbac42f2fe52798" ></div>

<script>
  // Determine initial zoom level based on screen width
  var initialZoom = 12; // Default zoom for larger screens
  if (window.innerWidth < 768) {
    initialZoom = 10; // Zoom out for smaller screens
  }



  var map_845a0ec8331ce3e14fbac42f2fe52798 = L.map(
 "map_845a0ec8331ce3e14fbac42f2fe52798",
 {
 center: [1.3521, 103.8198],
 crs: L.CRS.EPSG3857,
 ...{
 "zoom": 12,
 "zoom": initialZoom,
 "preferCanvas": false,
 }

 }
 );

 var tile_layer_42c9db8e347aa656d59682a82154c117 = L.tileLayer(
 "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
 {
 "minZoom": 0, "maxZoom": 19, "maxNativeZoom": 19, "noWrap": false, "attribution": "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors", "subdomains": "abc", "detectRetina": false, "tms": false, "opacity": 1,
 }

 );
 tile_layer_42c9db8e347aa656d59682a82154c117.addTo(map_845a0ec8331ce3e14fbac42f2fe52798);
 var locate_control_ade0279986b237a4afc7e0fa78c82a55 = L.control.locate(
 {}
 ).addTo(map_845a0ec8331ce3e14fbac42f2fe52798);

  // Add Scale control
  L.control.scale({ position: 'bottomright' }).addTo(map_845a0ec8331ce3e14fbac42f2fe52798);


  const taxiLayer = L.layerGroup().addTo(map_845a0ec8331ce3e14fbac42f2fe52798);

  async function refreshTaxiMarkers() {
    try {
      const timestamp = new Date().getTime(); // Get current timestamp
      const res = await fetch('taxi-data.json?' + timestamp); // Append timestamp as query parameter
      const data = await res.json();
      taxiLayer.clearLayers();

      const taxiCount = data.value.length;
      document.getElementById('taxi-count').innerText = 'Total taxis: ' + taxiCount;
      document.getElementById('taxi-count').style.display = 'block'; // Show the taxi count

      for (const taxi of data.value) {
        // Update taxi count display
        L.circleMarker([taxi.Latitude, taxi.Longitude], {
          radius: 2,
          color: 'blue',
          fillOpacity: 0.7
        }).addTo(taxiLayer);
      }

      const updateTimestamp = new Date().toLocaleString();
      document.getElementById('timestamp').style.display = 'block'; // Show the timestamp
      document.getElementById('timestamp').innerText = 'Last updated: ' + updateTimestamp;
    } catch (err) {
      console.error("Taxi data refresh failed:", err);
    }
  }

  // Refresh every 60 seconds
  setInterval(refreshTaxiMarkers, 60000);

  // Initial call to display markers immediately
  refreshTaxiMarkers();

  L.easyButton('fa-home', function(){
    map_845a0ec8331ce3e14fbac42f2fe52798.flyTo([1.3521, 103.8198], 12);
  }, 'Zoom to Home').addTo(map_845a0ec8331ce3e14fbac42f2fe52798);
</script>

</body>

</html>
